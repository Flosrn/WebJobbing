{"version":3,"sources":["../../src/pages/offer/offer.module.ts","../../src/pages/offer/offer.ts"],"names":[],"mappings":"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","file":"15.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { OfferPage } from './offer';\n\n@NgModule({\n  declarations: [\n    OfferPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(OfferPage),\n  ],\n})\nexport class OfferPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/offer/offer.module.ts","import { Component, ViewChild, Output, EventEmitter } from '@angular/core';\nimport { ViewController, IonicPage, NavParams, Slides, ModalController, NavController } from 'ionic-angular';\nimport { Observable } from 'rxjs/Observable';\nimport { Profile } from '../../models/profile/profile.interface';\nimport { DataService } from './../../providers/data/data.service';\nimport { PhotoViewer } from '@ionic-native/photo-viewer';\nimport { AuthService } from '../../providers/auth/auth.service';\nimport { User } from \"firebase/app\";\nimport { ToastService2 } from '../../providers/toast/toast.services';\nimport { RequestModalPage } from '../request-modal/request-modal';\nimport { Offer } from '../../models/offer/offer.model';\nimport { OfferListService } from '../../providers/offer/offer-list.services';\nimport { RequestListService } from '../../providers/request/request-list.services';\nimport { Subscription } from 'rxjs/Subscription';\nimport { AlertService } from '../../providers/util/alert.service';\nimport { EmailComposer } from '@ionic-native/email-composer';\n\n\n@IonicPage()\n@Component({\n  selector: 'page-offer',\n  templateUrl: 'offer.html',\n})\nexport class OfferPage {\n  \n  requestList$ = [];\n  profileList$: Observable<Profile[]>;\n  \n  \n  private authenticatedUser$: Subscription;\n  private authenticatedUser: User;\n  \n  request: any;\n  \n  offer: Offer = {\n    uidProfile: '',\n    uidRequest: '',\n    price: undefined,\n    comment: '',\n  }\n  \n  public userProfile: Profile;\n  @Output() existingProfile: EventEmitter<Profile>;\n  \n  constructor(\n    public viewCtrl: ViewController,\n    public navParams: NavParams,\n    public navCtrl: NavController,\n    private data: DataService,\n    public modalCtrl: ModalController,\n    private photoViewer: PhotoViewer,\n    private auth: AuthService, \n    private toast: ToastService2,\n    private offerList: OfferListService,\n    private requests: RequestListService,\n    private alertCtrl2: AlertService,\n    private emailComposer: EmailComposer,\n  ) {\n    \n    this.authenticatedUser$ = this.auth.getAuthenticatedUser().subscribe((user: User) => {\n      this.authenticatedUser = user;\n    }) \n    \n    this.existingProfile = new EventEmitter<Profile>();\n    \n    // Récupère les données transmit par la request\n    this.request = this.navParams.get('request');\n    \n    \n    // this.profileList$ = this.data.getProfileList().snapshotChanges().map(\n    //   changes => {\n    //     return changes.map(c => ({\n    //       key: c.payload.key, ...c.payload.val()\n    //     }));\n    //   });\n    \n    // // Récupère la liste des requests\n    // this.requests.getRequestListRef().once('value').then(snap => {\n    //   snap.forEach(element => {\n    //     data.getUid(element.val().uidProfile).valueChanges().subscribe(c => {\n    //       let userRequest = element.val();  \n    //       userRequest['userRequest'] = c;\n    \n    //       this.requestList$.push(userRequest);\n    //     });\n    //   });\n    // });\n  }  \n  \n  // Récupère les données de l'utilisateur\n  ngOnInit(): void {  \n    this.auth.getAuthenticatedUser().subscribe((user: User) => {\n      this.data.getProfile(user).valueChanges().subscribe((profile: Profile) => {\n        this.userProfile = <Profile>profile;\n        this.userProfile.uid = user.uid;\n        console.log('Utilisateur connecté :',this.userProfile); \n        this.existingProfile.emit(this.userProfile);\n      })\n    })\n  }\n  \n  // Ajoute l'offre, message toast, redirige\n  addOffer(offer: Offer) {\n    if(this.userProfile.userPermission === 1) {\n      this.offer.uidProfile = this.userProfile.uid;\n      this.offer.uidRequest = this.request.uidRequest;\n      this.offerList.addOffer(this.offer).then(ref => {\n        \n        this.userProfile.workDone =  this.userProfile.workDone + 1;\n        this.data.updateProfile(this.authenticatedUser, this.userProfile);\n        \n        this.toast.show(`${offer.price} ajouté !`);\n        this.navCtrl.pop();\n      })\n    } else {\n      this.alertCtrl2.presentAlertWithCallback('Permission non accordée', 'Pour des raisons de sécurité, une autorisation de l\\'administrateur de cette application est nécessaire pour effectuer cette action, contacter l\\'administrateur ?').then(ok => {\n        if(ok) {\n          let email = {\n            to: 'florian.seran@gmail.com',\n            attachments: [\n            ],\n            subject: 'WebJobbing permission',\n            body: 'prenom:' + this.userProfile.firstName +'<br  \\>' + 'nom: '+ this.userProfile.lastName + '<br  \\>' + 'email: ' + this.userProfile.email + '<br  \\><br  \\>' + 'Bonjour, je souhaiterais accéder à toutes les fonctionnalités de l\\'application.',\n            isHtml: true\n          };\n          // Send a text message using default options\n          this.emailComposer.open(email);\n        } else {\n\n        }\n      });\n    }\n  }\n  \n  back() { \n    this.viewCtrl.dismiss();\n  }\n  \n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/offer/offer.ts"],"sourceRoot":""}